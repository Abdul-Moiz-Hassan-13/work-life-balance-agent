<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI-powered Work-Life Balance Buddy">
    <title>Work-Life Balance Buddy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-gray-50 to-blue-50">

    <div class="bg-gradient-to-r from-indigo-600 to-purple-700 text-white py-8 px-4 mb-8 shadow-lg">
        <div class="max-w-6xl mx-auto">
            <div class="flex items-center gap-4">
                <div class="p-3 rounded-xl bg-white/20 backdrop-blur-sm">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3">
                        </path>
                    </svg>
                </div>
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold">Work-Life Balance Buddy</h1>
                    <p class="text-indigo-100 mt-1">AI-Powered Analysis Of Your Daily Routine</p>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-6xl mx-auto px-4 pb-12">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <div class="lg:col-span-2 space-y-6">

                <div class="bg-white rounded-2xl shadow-lg p-6 border border-gray-200">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
                        <div class="flex items-center gap-3 min-w-0">
                            <div class="p-2 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-lg flex-shrink-0">
                                <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div class="min-w-0">
                                <h2 class="text-lg sm:text-xl font-bold text-gray-900">Describe Your Daily Routine</h2>
                                <p class="text-gray-600 text-xs sm:text-sm">Include work hours, sleep schedule, meals, exercise, and leisure<br>activities</p>
                            </div>
                        </div>

                        <div class="flex items-center gap-3 self-start sm:self-center">
                            <span class="text-sm font-medium text-gray-600 whitespace-nowrap">Lazy Mode</span>
                            <button onclick="toggleLazyMode()" id="toggleSwitch"
                                class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-300 transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 flex-shrink-0"
                                role="switch" aria-checked="false">
                                <span id="toggleHandle"
                                    class="inline-block h-4 w-4 transform rounded-full bg-white shadow-lg transition-transform duration-200 ease-in-out translate-x-1"></span>
                            </button>
                        </div>
                    </div>

                    <div id="paragraphMode" class="space-y-4">

                        <textarea id="userInput"
                            class="w-full h-48 p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none bg-gray-50"
                            placeholder="Example: I wake up at 7am, work from 9am to 6pm, exercise at 7pm, have dinner at 8pm, and sleep at 11pm..."></textarea>

                        <div class="flex flex-wrap gap-2 mt-4">
                            <span class="text-sm text-gray-500">Quick examples:</span>
                            <button onclick="loadExample(0)"
                                class="px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-full transition-all">Example
                                1</button>
                            <button onclick="loadExample(1)"
                                class="px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-full transition-all">Example
                                2</button>
                            <button onclick="loadExample(2)"
                                class="px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-full transition-all">Example
                                3</button>
                            <button onclick="loadExample(3)"
                                class="px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-full transition-all">Example
                                4</button>
                            <button onclick="loadExample(4)"
                                class="px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-full transition-all">Example
                                5</button>
                        </div>
                    </div>

                    <div id="lazyMode" class="hidden space-y-4">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Wake up time</label>
                                <input type="text" id="wakeUpTime"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    placeholder="7:00 AM">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Sleep time</label>
                                <input type="text" id="sleepTime"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    placeholder="11:00 PM">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Work start time</label>
                                <input type="text" id="workStart"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    placeholder="9:00 AM">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Work end time</label>
                                <input type="text" id="workEnd"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    placeholder="6:00 PM">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Exercise time</label>
                                <input type="text" id="exerciseTime"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    placeholder="7:00 PM">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Exercise duration</label>
                                <input type="text" id="exerciseDuration"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    placeholder="30 minutes">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Additional notes</label>
                            <textarea id="lazyNotes"
                                class="w-full h-24 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none bg-gray-50"
                                placeholder="e.g., Meals, breaks, hobbies, family time, etc."></textarea>
                        </div>
                    </div>

                    <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg flex items-start gap-3">
                        <svg class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd"
                                d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                clip-rule="evenodd"></path>
                        </svg>
                        <div>
                            <p class="text-sm font-medium text-blue-900">Server Deployed On Render Free Tier</p>
                            <p class="text-sm text-blue-700 mt-1">The service may take 1-2 minutes to wake up on first
                                use.</p>
                        </div>
                    </div>

                    <div class="flex flex-col sm:flex-row gap-3 mt-6">
                        <button id="analyzeBtn" onclick="sendRequest()"
                            class="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white py-3 rounded-xl font-medium shadow-md flex items-center justify-center gap-2">
                            <svg id="spinner" class="w-5 h-5 animate-spin hidden" xmlns="http://www.w3.org/2000/svg"
                                fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="white" stroke-width="4">
                                </circle>
                                <path class="opacity-75" fill="white" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                            </svg>
                            <span id="btnText">Analyze Routine</span>
                        </button>
                        <button id="saveBtn" onclick="saveRoutine()"
                            class="flex-1 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white py-3 rounded-xl font-medium shadow-md flex items-center justify-center gap-2"
                            disabled>
                            <span id="saveBtnText">Save for Trends</span>
                        </button>
                    </div>

                    <div id="error-container" class="hidden mt-4 p-4 bg-red-50 border border-red-200 rounded-xl">
                        <div class="flex items-center gap-2 text-red-700">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 8v4m0 4v.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span id="error-text" class="font-medium"></span>
                        </div>
                    </div>
                </div>

                <div id="result-container" class="hidden space-y-6">
                    <div class="bg-white rounded-2xl shadow-lg p-6 border border-gray-200">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
                            <div class="flex items-center gap-3 min-w-0">
                                <div
                                    class="p-2 bg-gradient-to-br from-amber-100 to-orange-100 rounded-lg flex-shrink-0">
                                    <svg class="w-6 h-6 text-amber-600" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                                        </path>
                                    </svg>
                                </div>
                                <div class="min-w-0">
                                    <h2 class="text-lg sm:text-xl font-bold text-gray-900">Analysis Results</h2>
                                    <p class="text-gray-600 text-xs sm:text-sm">AI-Powered Insights Into Your Routine
                                    </p>
                                </div>
                            </div>
                            <div id="risk-badge"
                                class="px-3 sm:px-4 py-1.5 sm:py-2 rounded-full text-white font-medium text-xs sm:text-sm whitespace-nowrap self-start sm:self-auto">
                            </div>
                        </div>

                        <div
                            class="mb-8 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-100">
                            <div class="flex items-center gap-2 mb-2">
                                <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 3v1m0 16v1m9-9h-1m-16 0H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                                    </path>
                                </svg>
                                <h3 class="font-bold text-gray-900">Overall Summary</h3>
                            </div>
                            <p id="summary" class="text-gray-700 leading-relaxed"></p>
                        </div>

                        <div class="mb-8">
                            <h3 class="font-bold text-gray-900 mb-3">Key Signals Detected</h3>
                            <div id="signals-list" class="flex flex-wrap gap-2"></div>
                        </div>

                        <div>
                            <h3 class="font-bold text-gray-900 mb-4">Personalized Recommendations</h3>
                            <div id="recommendations" class="space-y-4"></div>
                        </div>

                        <div class="mt-8 pt-6 border-t border-gray-200">
                            <div id="balance-status" class="flex items-center justify-center gap-3">
                                <div id="balance-icon" class="p-3 rounded-full"></div>
                                <div>
                                    <h4 id="balance-title" class="font-bold text-gray-900"></h4>
                                    <p id="balance-text" class="text-gray-600 text-sm"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="space-y-6">

                <div class="bg-white rounded-2xl shadow-lg p-6 border border-gray-200">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-gradient-to-br from-emerald-100 to-teal-100 rounded-lg">
                                <svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                                    </path>
                                </svg>
                            </div>
                            <div>
                                <h2 class="text-xl font-bold text-gray-900">Saved Routines</h2>
                                <p class="text-gray-600 text-sm">Track your progress over time</p>
                            </div>
                        </div>
                    </div>

                    <div id="saved-routines-list" class="space-y-3 max-h-96 overflow-y-auto">
                        <div class="text-center py-8">
                            <div
                                class="w-16 h-16 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V5">
                                    </path>
                                </svg>
                            </div>
                            <p class="text-gray-600 mb-2">No saved routines yet</p>
                            <p class="text-gray-500 text-sm">Save your analyzed routines to track changes over time</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-lg p-6 border border-gray-200">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-gradient-to-br from-blue-100 to-cyan-100 rounded-lg">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                                </svg>
                            </div>
                            <div>
                                <h2 class="text-lg font-bold text-gray-900">Export Format</h2>
                                <p class="text-gray-600 text-sm">Choose download format</p>
                            </div>
                        </div>
                    </div>

                    <div class="flex gap-2">
                        <button id="downloadJsonBtn" onclick="downloadRoutines('json')"
                            class="flex-1 bg-blue-50 hover:bg-blue-100 text-blue-700 py-2 px-3 rounded-lg font-medium text-sm transition-colors border border-blue-200"
                            disabled>
                            JSON
                        </button>
                        <button id="downloadTxtBtn" onclick="downloadRoutines('txt')"
                            class="flex-1 bg-green-50 hover:bg-green-100 text-green-700 py-2 px-3 rounded-lg font-medium text-sm transition-colors border border-green-200"
                            disabled>
                            TXT
                        </button>
                    </div>
                </div>

                <div
                    class="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl shadow-lg p-6 border border-indigo-100">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="p-2 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-lg">
                            <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z">
                                </path>
                            </svg>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-gray-900">Wellness Tips</h2>
                            <p class="text-indigo-600 text-sm">For better work-life balance</p>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="flex items-start gap-3">
                            <div class="p-2 bg-white rounded-lg shadow-sm flex-shrink-0">
                                <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900">Set Boundaries</h4>
                                <p class="text-gray-600 text-sm">Define clear work hours and stick to them</p>
                            </div>
                        </div>

                        <div class="flex items-start gap-3">
                            <div class="p-2 bg-white rounded-lg shadow-sm flex-shrink-0">
                                <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                                </svg>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900">Sleep Schedule</h4>
                                <p class="text-gray-600 text-sm">Aim for 7-9 hours of consistent sleep</p>
                            </div>
                        </div>

                        <div class="flex items-start gap-3">
                            <div class="p-2 bg-white rounded-lg shadow-sm flex-shrink-0">
                                <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900">Daily Movement</h4>
                                <p class="text-gray-600 text-sm">30 minutes of exercise improves physical and mental
                                    health</p>
                            </div>
                        </div>

                        <div class="flex items-start gap-3">
                            <div class="p-2 bg-white rounded-lg shadow-sm flex-shrink-0">
                                <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z">
                                    </path>
                                </svg>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900">Social Connection</h4>
                                <p class="text-gray-600 text-sm">Make time for friends and family regularly</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>

    <script>
        const exampleRoutines = [
            "I work from 9am to 5pm, exercise at 6pm, sleep at 11pm, spend time with family in evenings",
            "Work 8am to 6pm, gym at 7pm, dinner at 8pm, work more until midnight",
            "Remote work from 10am to 7pm, walk at 8pm, relax until 12am",
            "Shift work: 3pm to 11pm, sleep at 2am, wake up at 10am",
            "Freelance: work in bursts throughout day, no fixed schedule, sleep irregularly"
        ];

        let savedRoutines = JSON.parse(localStorage.getItem("savedRoutines")) || [];
        let currentAnalysis = null;
        let currentMode = 'Active Mode';

        const BACKEND_URL = 'https://work-life-balance-agent.onrender.com/api/work-life-balance/analyze';

        async function wakeUpBackend() {
            try {
                await fetch('https://work-life-balance-agent.onrender.com/health', {
                    method: 'GET',
                    mode: 'no-cors'
                });
            } catch (error) {
            }
        }

        let isLazyMode = false;

        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('paragraphMode').classList.remove('hidden');
            document.getElementById('lazyMode').classList.add('hidden');

            const toggleSwitch = document.getElementById('toggleSwitch');
            const toggleHandle = document.getElementById('toggleHandle');
            toggleSwitch.classList.remove('bg-indigo-600');
            toggleSwitch.classList.add('bg-gray-300');
            toggleHandle.style.transform = 'translateX(0.25rem)';
            toggleSwitch.setAttribute('aria-checked', 'false');
            isLazyMode = false;

            wakeUpBackend();
            updateSavedRoutinesList();
            document.getElementById('userInput').addEventListener('focus', wakeUpBackend);
        });

        function toggleLazyMode() {
            isLazyMode = !isLazyMode;
            const toggleSwitch = document.getElementById('toggleSwitch');
            const toggleHandle = document.getElementById('toggleHandle');
            const paragraphMode = document.getElementById('paragraphMode');
            const lazyMode = document.getElementById('lazyMode');

            if (isLazyMode) {
                toggleSwitch.classList.remove('bg-gray-300');
                toggleSwitch.classList.add('bg-indigo-600');
                toggleHandle.style.transform = 'translateX(1.625rem)';
                toggleSwitch.setAttribute('aria-checked', 'true');

                paragraphMode.classList.add('hidden');
                lazyMode.classList.remove('hidden');
            } else {
                toggleSwitch.classList.remove('bg-indigo-600');
                toggleSwitch.classList.add('bg-gray-300');
                toggleHandle.style.transform = 'translateX(0.25rem)';
                toggleSwitch.setAttribute('aria-checked', 'false');

                paragraphMode.classList.remove('hidden');
                lazyMode.classList.add('hidden');
            }
        }

        function generateRoutineFromLazy() {
            const wakeUpTime = document.getElementById('wakeUpTime').value;
            const sleepTime = document.getElementById('sleepTime').value;
            const workStart = document.getElementById('workStart').value;
            const workEnd = document.getElementById('workEnd').value;
            const exerciseTime = document.getElementById('exerciseTime').value;
            const exerciseDuration = document.getElementById('exerciseDuration').value;
            const lazyNotes = document.getElementById('lazyNotes').value;

            let routine = [];
            if (wakeUpTime) routine.push(`I wake up at ${wakeUpTime}`);
            if (workStart && workEnd) routine.push(`work from ${workStart} to ${workEnd}`);
            if (exerciseTime && exerciseDuration) routine.push(`exercise at ${exerciseTime} for ${exerciseDuration} minutes`);
            if (sleepTime) routine.push(`sleep at ${sleepTime}`);
            if (lazyNotes) routine.push(lazyNotes);

            return routine.length > 0 ? routine.join(', ') : '';
        }

        function loadExample(index) {
            document.getElementById("userInput").value = exampleRoutines[index];
            clearError();
        }

        function clearError() {
            document.getElementById("error-container").classList.add("hidden");
            document.getElementById("error-text").textContent = "";
        }

        function showError(message) {
            document.getElementById("error-container").classList.remove("hidden");
            document.getElementById("error-text").textContent = message;
        }

        async function sendRequest() {
            let userInput;

            if (isLazyMode) {
                userInput = generateRoutineFromLazy().trim();
            } else {
                userInput = document.getElementById("userInput").value.trim();
            }

            if (!userInput) {
                showError("Please Describe Your Daily Routine");
                return;
            }

            const btn = document.getElementById("analyzeBtn");
            const btnText = document.getElementById("btnText");
            const spinner = document.getElementById("spinner");

            btn.disabled = true;
            btnText.textContent = "Analyzing...";
            spinner.classList.remove("hidden");
            clearError();

            const payload = {
                messages: [
                    { role: "user", content: userInput }
                ]
            };

            try {
                console.log("Sending request to backend...");

                const response = await fetch(BACKEND_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error("Backend error:", errorText);

                    if (response.status === 404) {
                        throw new Error("Backend endpoint not found. Check if server is running.");
                    } else if (response.status >= 500) {
                        throw new Error("Backend server error. It might be waking up (takes 1-2 minutes).");
                    } else {
                        throw new Error(`Server error: ${response.status}`);
                    }
                }

                const result = await response.json();
                console.log("Received result:", result);

                if (result.status === "success") {
                    currentAnalysis = result.data.message;
                    renderResult();
                    document.getElementById("saveBtn").disabled = false;
                } else {
                    showError(result.error_message || "Failed To Analyze Routine");
                }

            } catch (err) {
                console.error("Analysis error:", err);
                showError(err.message || "Service temporarily unavailable. Please try again in 30 seconds.");
            } finally {
                btn.disabled = false;
                btnText.textContent = "Analyze Routine";
                spinner.classList.add("hidden");
            }
        }

        function renderResult() {
            if (!currentAnalysis) return;

            const data = currentAnalysis;
            const resultContainer = document.getElementById("result-container");
            resultContainer.classList.remove("hidden");

            const summaryText = data.summary.charAt(0).toUpperCase() + data.summary.slice(1);
            document.getElementById("summary").textContent = summaryText;

            const riskBadge = document.getElementById("risk-badge");
            riskBadge.innerHTML = getRiskBadgeHTML(data.risk_level);

            const signalsList = document.getElementById("signals-list");
            signalsList.innerHTML = "";
            if (data.signals && data.signals.length > 0) {
                data.signals.forEach(signal => {
                    const span = document.createElement("span");
                    span.className = "px-3 py-1.5 bg-gray-100 text-gray-700 rounded-full text-sm font-medium";
                    span.textContent = signal.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                    signalsList.appendChild(span);
                });
            } else {
                signalsList.innerHTML = '<span class="text-gray-500 text-sm">No Specific Signals Detected</span>';
            }

            const recBox = document.getElementById("recommendations");
            recBox.innerHTML = "";
            if (data.recommendations && data.recommendations.length > 0) {
                data.recommendations.forEach((rec, idx) => {
                    const priorityColor = {
                        'high': { bg: 'bg-red-50', border: 'border-l-red-500', badge: 'bg-red-100 text-red-800' },
                        'medium': { bg: 'bg-amber-50', border: 'border-l-amber-500', badge: 'bg-amber-100 text-amber-800' },
                        'low': { bg: 'bg-emerald-50', border: 'border-l-emerald-500', badge: 'bg-emerald-100 text-emerald-800' }
                    }[rec.priority] || { bg: 'bg-blue-50', border: 'border-l-blue-500', badge: 'bg-blue-100 text-blue-800' };

                    const div = document.createElement("div");
                    div.className = `p-4 rounded-xl border-l-4 ${priorityColor.bg} ${priorityColor.border}`;
                    div.innerHTML = `
                    <div class="flex items-start gap-3">
                        <div class="p-2 bg-white rounded-lg shadow-sm mt-0.5">
                            ${getCategoryIcon(rec.category)}
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-1">
                                <h4 class="font-semibold text-gray-900">${rec.category.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}</h4>
                                <span class="px-2 py-1 rounded-full text-xs font-medium ${priorityColor.badge}">
                                    ${rec.priority.charAt(0).toUpperCase() + rec.priority.slice(1)} Priority
                                </span>
                            </div>
                            <p class="text-gray-700">${rec.advice.charAt(0).toUpperCase() + rec.advice.slice(1)}</p>
                        </div>
                    </div>
                `;
                    recBox.appendChild(div);
                });
            }

            const balanceIcon = document.getElementById("balance-icon");
            const balanceTitle = document.getElementById("balance-title");
            const balanceText = document.getElementById("balance-text");

            if (data.balanced) {
                balanceIcon.className = "p-3 rounded-full bg-emerald-100 text-emerald-600";
                balanceIcon.innerHTML = '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>';
                balanceTitle.textContent = "Well Balanced!";
                balanceText.textContent = "Your Routine Shows Good Work-Life Balance.";
            } else {
                balanceIcon.className = "p-3 rounded-full bg-red-100 text-red-600";
                balanceIcon.innerHTML = '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"></path></svg>';
                balanceTitle.textContent = "Needs Improvement";
                balanceText.textContent = "Consider Implementing The Recommendations Above.";
            }
        }

        function getRiskBadgeHTML(riskLevel) {
            const risk = riskLevel?.toLowerCase();
            const config = {
                'high': { class: 'bg-gradient-to-r from-red-500 to-red-600', text: 'High Risk' },
                'medium': { class: 'bg-gradient-to-r from-amber-500 to-amber-600', text: 'Medium Risk' },
                'low': { class: 'bg-gradient-to-r from-emerald-500 to-emerald-600', text: 'Low Risk' }
            }[risk] || { class: 'bg-blue-500', text: 'Unknown Risk' };

            return `
            <div class="${config.class} px-4 py-2 rounded-full inline-flex items-center gap-2">
                <span class="capitalize">${config.text}</span>
            </div>
        `;
        }

        function getCategoryIcon(category) {
            const icons = {
                'work schedule': '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',
                'sleep habits': '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path></svg>',
                'self-care': '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>',
                'exercise': '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>',
                'nutrition': '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>',
                'social': '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.856-1.487M15 10a3 3 0 11-6 0 3 3 0 016 0zM6 20v-2a3 3 0 00-3-3H2"></path></svg>',
                'hobbies': '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>'
            };
            return icons[category?.toLowerCase()] || '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg>';
        }

        function saveRoutine() {
            if (!currentAnalysis) {
                showError("Please analyze a routine first");
                return;
            }

            let routineText;
            if (isLazyMode) {
                routineText = generateRoutineFromLazy();
            } else {
                routineText = document.getElementById("userInput").value;
            }

            const newRoutine = {
                id: Date.now(),
                routine: routineText,
                analysis: currentAnalysis,
                timestamp: new Date().toISOString(),
                date: new Date().toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                })
            };

            savedRoutines.push(newRoutine);
            localStorage.setItem("savedRoutines", JSON.stringify(savedRoutines));

            const saveBtn = document.getElementById("saveBtn");
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg><span>Saved!</span>';
            saveBtn.disabled = true;

            setTimeout(() => {
                saveBtn.innerHTML = originalText;
                document.getElementById("userInput").value = "";
                document.getElementById("wakeUpTime").value = "";
                document.getElementById("sleepTime").value = "";
                document.getElementById("workStart").value = "";
                document.getElementById("workEnd").value = "";
                document.getElementById("exerciseTime").value = "";
                document.getElementById("exerciseDuration").value = "";
                document.getElementById("lazyNotes").value = "";
                currentAnalysis = null;
                document.getElementById("result-container").classList.add("hidden");
                document.getElementById("saveBtn").disabled = true;
                updateSavedRoutinesList();
            }, 1500);
        }

        function updateSavedRoutinesList() {
            const list = document.getElementById("saved-routines-list");
            const downloadJsonBtn = document.getElementById("downloadJsonBtn");
            const downloadTxtBtn = document.getElementById("downloadTxtBtn");

            if (savedRoutines.length === 0) {
                downloadJsonBtn.disabled = true;
                downloadTxtBtn.disabled = true;
            } else {
                downloadJsonBtn.disabled = false;
                downloadTxtBtn.disabled = false;
            }

            if (savedRoutines.length === 0) {
                list.innerHTML = `
                <div class="text-center py-8">
                    <div class="w-16 h-16 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V5"></path>
                        </svg>
                    </div>
                    <p class="text-gray-600 mb-2">No saved routines yet</p>
                    <p class="text-gray-500 text-sm">Save your analyzed routines to track changes over time</p>
                </div>
            `;
                return;
            }

            list.innerHTML = "";
            savedRoutines.slice().reverse().forEach((item) => {
                const riskColor = item.analysis.risk_level === 'high'
                    ? 'bg-red-50'
                    : item.analysis.risk_level === 'medium'
                        ? 'bg-amber-50'
                        : 'bg-emerald-50';

                const riskDot = item.analysis.risk_level === 'high'
                    ? 'bg-red-500'
                    : item.analysis.risk_level === 'medium'
                        ? 'bg-amber-500'
                        : 'bg-emerald-500';

                const div = document.createElement("div");
                div.className = `p-3 sm:p-4 rounded-xl border border-gray-200 transition-all cursor-pointer hover:shadow-md ${riskColor}`;
                div.innerHTML = `
                <div class="flex flex-col gap-2 mb-2">
                    <div class="flex items-center justify-between gap-2 flex-wrap">
                        <span class="text-xs sm:text-sm font-medium text-gray-700">${item.date}</span>
                        <div class="flex items-center gap-1 sm:gap-2 flex-wrap justify-end">
                            <span class="px-1.5 sm:px-2 py-0.5 sm:py-1 rounded-full text-xs font-medium whitespace-nowrap ${item.analysis.balanced ? 'bg-emerald-100 text-emerald-800' : 'bg-red-100 text-red-800'}">
                                ${item.analysis.balanced ? 'Balanced' : 'Work'}
                            </span>
                            <button onclick="viewRoutine(${item.id})" class="p-1 hover:bg-white/50 rounded transition-colors flex-shrink-0" title="View">
                                <svg class="w-3.5 h-3.5 sm:w-4 sm:h-4 text-gray-500 hover:text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                            <button onclick="deleteRoutine(${item.id})" class="p-1 hover:bg-white/50 rounded transition-colors flex-shrink-0" title="Delete">
                                <svg class="w-3.5 h-3.5 sm:w-4 sm:h-4 text-gray-500 hover:text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                <p class="text-xs sm:text-sm text-gray-600 truncate">${item.routine}</p>
                <div class="flex items-center gap-2 mt-2 sm:mt-3">
                    <div class="w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full ${riskDot}"></div>
                    <span class="text-xs text-gray-500 capitalize">${item.analysis.risk_level} risk</span>
                </div>
            `;
                list.appendChild(div);
            });
        }

        function deleteRoutine(id) {
            savedRoutines = savedRoutines.filter(r => r.id !== id);
            localStorage.setItem("savedRoutines", JSON.stringify(savedRoutines));
            updateSavedRoutinesList();
        }

        function downloadRoutines(format = 'json') {
            if (format === 'json') {
                const dataStr = JSON.stringify(savedRoutines, null, 2);
                const dataBlob = new Blob([dataStr], { type: "application/json" });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement("a");
                link.href = url;
                link.download = `routines-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
            } else if (format === 'txt') {
                let txtContent = `WORK-LIFE BALANCE AGENT - SAVED ROUTINES\n`;
                txtContent += `Generated: ${new Date().toLocaleString()}\n`;
                txtContent += `=${'='.repeat(60)}\n\n`;

                savedRoutines.forEach((item, index) => {
                    txtContent += `ROUTINE #${index + 1}\n`;
                    txtContent += `-${'='.repeat(57)}\n`;
                    txtContent += `Date: ${item.date}\n`;
                    txtContent += `Saved: ${new Date(item.timestamp).toLocaleString()}\n\n`;

                    txtContent += `DESCRIPTION:\n`;
                    txtContent += `${item.routine}\n\n`;

                    txtContent += `ANALYSIS RESULTS:\n`;
                    txtContent += `Balance Status: ${item.analysis.balanced ? 'BALANCED' : 'NEEDS IMPROVEMENT'}\n`;
                    txtContent += `Risk Level: ${item.analysis.risk_level?.toUpperCase()}\n`;
                    txtContent += `Summary: ${item.analysis.summary}\n\n`;

                    if (item.analysis.signals && item.analysis.signals.length > 0) {
                        txtContent += `Key Signals:\n`;
                        item.analysis.signals.forEach(signal => {
                            txtContent += `   ${signal}\n`;
                        });
                        txtContent += '\n';
                    }

                    if (item.analysis.recommendations && item.analysis.recommendations.length > 0) {
                        txtContent += `Recommendations:\n`;
                        item.analysis.recommendations.forEach(rec => {
                            txtContent += `  [${rec.priority.toUpperCase()}] ${rec.category}: ${rec.advice}\n`;
                        });
                        txtContent += '\n';
                    }

                    txtContent += `${'='.repeat(60)}\n\n`;
                });

                const dataBlob = new Blob([txtContent], { type: "text/plain" });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement("a");
                link.href = url;
                link.download = `routines-${new Date().toISOString().split('T')[0]}.txt`;
                link.click();
                URL.revokeObjectURL(url);
            }
        }

        function viewRoutine(id) {
            const routine = savedRoutines.find(r => r.id === id);
            if (!routine) return;

            const modal = document.getElementById("routineModal");
            const analysis = routine.analysis;

            document.getElementById("modalRoutine").textContent = routine.routine;
            document.getElementById("modalSummary").textContent = analysis.summary;
            document.getElementById("modalRiskLevel").textContent = analysis.risk_level?.charAt(0).toUpperCase() + analysis.risk_level?.slice(1);
            document.getElementById("modalBalance").textContent = analysis.balanced ? 'Balanced' : 'Needs Improvement';

            const signalsContainer = document.getElementById("modalSignals");
            signalsContainer.innerHTML = "";
            if (analysis.signals && analysis.signals.length > 0) {
                analysis.signals.forEach(signal => {
                    const span = document.createElement("span");
                    span.className = "px-3 py-1.5 bg-gray-100 text-gray-700 rounded-full text-sm font-medium";
                    span.textContent = signal.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                    signalsContainer.appendChild(span);
                });
            } else {
                signalsContainer.innerHTML = '<span class="text-gray-500 text-sm">No specific signals detected</span>';
            }

            const recsContainer = document.getElementById("modalRecommendations");
            recsContainer.innerHTML = "";
            if (analysis.recommendations && analysis.recommendations.length > 0) {
                analysis.recommendations.forEach(rec => {
                    const priorityColor = {
                        'high': { bg: 'bg-red-50', border: 'border-l-red-500', badge: 'bg-red-100 text-red-800' },
                        'medium': { bg: 'bg-amber-50', border: 'border-l-amber-500', badge: 'bg-amber-100 text-amber-800' },
                        'low': { bg: 'bg-emerald-50', border: 'border-l-emerald-500', badge: 'bg-emerald-100 text-emerald-800' }
                    }[rec.priority] || { bg: 'bg-blue-50', border: 'border-l-blue-500', badge: 'bg-blue-100 text-blue-800' };

                    const div = document.createElement("div");
                    div.className = `p-3 rounded-lg border-l-4 ${priorityColor.bg} ${priorityColor.border}`;
                    div.innerHTML = `
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-900 text-sm">${rec.category.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}</h4>
                            <p class="text-gray-700 text-sm mt-1">${rec.advice.charAt(0).toUpperCase() + rec.advice.slice(1)}</p>
                        </div>
                        <span class="ml-2 px-2 py-1 rounded text-xs font-medium whitespace-nowrap ${priorityColor.badge}">
                            ${rec.priority.charAt(0).toUpperCase() + rec.priority.slice(1)}
                        </span>
                    </div>
                `;
                    recsContainer.appendChild(div);
                });
            }

            modal.classList.remove("hidden");
        }

        function closeModal() {
            document.getElementById("routineModal").classList.add("hidden");
        }

        document.addEventListener('keydown', function (event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });
    </script>

    <div id="routineModal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-2 sm:p-4 backdrop-blur-sm overflow-y-auto">
        <div
            class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[95vh] sm:max-h-[90vh] overflow-y-auto transform transition-all duration-300 my-2">
            <div
                class="sticky top-0 bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-4 sm:p-6 flex items-center justify-between rounded-t-2xl gap-2">
                <div class="flex items-center gap-2 sm:gap-3 min-w-0">
                    <div class="p-1.5 sm:p-2 rounded-lg bg-white/20 backdrop-blur-sm flex-shrink-0">
                        <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <h2 class="text-lg sm:text-2xl font-bold truncate">Routine Details</h2>
                </div>
                <button onclick="closeModal()"
                    class="p-1.5 sm:p-2 hover:bg-white/20 rounded-lg transition-colors flex-shrink-0">
                    <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>
            <div class="p-4 sm:p-6 space-y-4 sm:space-y-6">
                <div class="bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-3 sm:p-4 border border-gray-200">
                    <div class="flex items-center gap-2 mb-3">
                        <div class="p-1.5 sm:p-2 bg-blue-100 rounded-lg flex-shrink-0">
                            <svg class="w-4 h-4 sm:w-4 sm:h-4 text-blue-600" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <h3 class="font-semibold text-sm sm:text-base text-gray-900">Your Routine</h3>
                    </div>
                    <p id="modalRoutine" class="text-xs sm:text-sm text-gray-700 whitespace-pre-wrap break-words"></p>
                </div>
                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-3 sm:p-4 border border-blue-200">
                    <div class="flex items-center gap-2 mb-3">
                        <div class="p-1.5 sm:p-2 bg-indigo-100 rounded-lg flex-shrink-0">
                            <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                                </path>
                            </svg>
                        </div>
                        <h3 class="font-semibold text-sm sm:text-base text-gray-900">Analysis Summary</h3>
                    </div>
                    <p id="modalSummary" class="text-xs sm:text-sm text-gray-700 mb-4"></p>
                    <div class="grid grid-cols-2 gap-2 sm:gap-3 mt-4">
                        <div class="bg-white p-3 sm:p-4 rounded-lg border border-blue-200 shadow-sm">
                            <p class="text-xs font-medium text-gray-600 uppercase tracking-wide">Risk Level</p>
                            <p id="modalRiskLevel" class="font-bold text-gray-900 mt-1 sm:mt-2 text-sm sm:text-base">
                            </p>
                        </div>
                        <div class="bg-white p-3 sm:p-4 rounded-lg border border-blue-200 shadow-sm">
                            <p class="text-xs font-medium text-gray-600 uppercase tracking-wide">Balance Status</p>
                            <p id="modalBalance" class="font-bold text-gray-900 mt-1 sm:mt-2 text-sm sm:text-base"></p>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="flex items-center gap-2 mb-3">
                        <div class="p-2 bg-yellow-100 rounded-lg">
                            <svg class="w-4 h-4 text-yellow-600" fill="currentColor" viewBox="0 0 20 20">
                                <path
                                    d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v1h8v-1zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z">
                                </path>
                            </svg>
                        </div>
                        <h3 class="font-semibold text-gray-900">Key Signals Detected</h3>
                    </div>
                    <div id="modalSignals"
                        class="flex flex-wrap gap-2 bg-yellow-50 p-3 rounded-lg border border-yellow-200"></div>
                </div>
                <div>
                    <div class="flex items-center gap-2 mb-3">
                        <div class="p-2 bg-emerald-100 rounded-lg">
                            <svg class="w-4 h-4 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                        </div>
                        <h3 class="font-semibold text-gray-900">Recommendations</h3>
                    </div>
                    <div id="modalRecommendations" class="space-y-3 max-h-64 overflow-y-auto pr-2"></div>
                </div>
            </div>
        </div>
    </div>

</body>

</html>