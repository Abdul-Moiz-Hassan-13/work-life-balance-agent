<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI-powered Work-Life Balance Agent - Get insights on your daily routine for better health and wellbeing">
    <meta name="theme-color" content="#4F46E5">
    
    <title>Work-Life Balance Agent - AI Health & Wellness</title>

    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f3f4f6 0%, #dbeafe 100%);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .risk-high {
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
        }
        
        .risk-medium {
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
        }
        
        .risk-low {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
        }
        
        .smooth-transition {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        textarea:focus {
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover:not(:disabled) {
            box-shadow: 0 10px 25px -5px rgba(79, 70, 229, 0.4);
            transform: translateY(-1px);
        }
        
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .skeleton {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>

</head>
<body class="min-h-screen">

    <div class="bg-gradient-to-r from-indigo-600 to-purple-700 text-white py-8 px-4 mb-8 shadow-lg">
        <div class="max-w-6xl mx-auto">
            <div class="flex items-center gap-4">
                <div class="p-3 rounded-xl bg-white/20 backdrop-blur-sm">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5l7 4H5l7-4zm0 0v14m-6-5h12M7 18h10"></path>
                    </svg>
                </div>
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold">Work-Life Balance Agent</h1>
                    <p class="text-indigo-100 mt-1">AI-Powered Analysis Of Your Daily Routine For Better Health And Wellbeing</p>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-6xl mx-auto px-4 pb-12">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <div class="lg:col-span-2 space-y-6">
                
                <div class="bg-white rounded-2xl shadow-lg p-6 border border-gray-200 card-hover">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="p-2 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-lg">
                            <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-gray-900">Describe Your Daily Routine</h2>
                            <p class="text-gray-600 text-sm">Include work hours, sleep schedule, meals, exercise, and leisure activities</p>
                        </div>
                    </div>

                    <textarea 
                        id="userInput"
                        class="w-full h-48 p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none bg-gray-50 disabled:opacity-70"
                        placeholder="Example: I wake up at 7am, work from 9am to 6pm, exercise at 7pm, have dinner at 8pm, and sleep at 11pm..."
                    ></textarea>

                    <div class="flex flex-wrap gap-2 mt-4">
                        <span class="text-sm text-gray-500">Quick examples:</span>
                        <button onclick="loadExample(0)" class="px-3 py-1.5 text-sm bg-gradient-to-r from-gray-100 to-gray-200 hover:from-gray-200 hover:to-gray-300 text-gray-700 rounded-full transition-all disabled:opacity-50">Example 1</button>
                        <button onclick="loadExample(1)" class="px-3 py-1.5 text-sm bg-gradient-to-r from-gray-100 to-gray-200 hover:from-gray-200 hover:to-gray-300 text-gray-700 rounded-full transition-all disabled:opacity-50">Example 2</button>
                        <button onclick="loadExample(2)" class="px-3 py-1.5 text-sm bg-gradient-to-r from-gray-100 to-gray-200 hover:from-gray-200 hover:to-gray-300 text-gray-700 rounded-full transition-all disabled:opacity-50">Example 3</button>
                        <button onclick="loadExample(3)" class="px-3 py-1.5 text-sm bg-gradient-to-r from-gray-100 to-gray-200 hover:from-gray-200 hover:to-gray-300 text-gray-700 rounded-full transition-all disabled:opacity-50">Example 4</button>
                        <button onclick="loadExample(4)" class="px-3 py-1.5 text-sm bg-gradient-to-r from-gray-100 to-gray-200 hover:from-gray-200 hover:to-gray-300 text-gray-700 rounded-full transition-all disabled:opacity-50">Example 5</button>
                    </div>

                    <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg flex items-start gap-3">
                        <svg class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        <div>
                            <p class="text-sm font-medium text-blue-900">Server Deployed On Render</p>
                            <p class="text-sm text-blue-700 mt-1">The service may take 1-2 minutes to wake up on first use. Once active, you'll experience lightning-fast response times!</p>
                        </div>
                    </div>

                    <div class="flex flex-col sm:flex-row gap-3 mt-6">
                        <button
                            id="analyzeBtn"
                            onclick="sendRequest()"
                            class="flex-1 btn-primary text-white py-3 rounded-xl font-medium shadow-md flex items-center justify-center gap-2"
                        >
                            <svg id="spinner" class="w-5 h-5 animate-spin hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="white" stroke-width="4"></circle>
                                <path class="opacity-75" fill="white" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                            </svg>
                            <span id="btnText">Analyze Routine</span>
                        </button>
                        <button
                            id="saveBtn"
                            onclick="saveRoutine()"
                            class="flex-1 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white py-3 rounded-xl font-medium shadow-md flex items-center justify-center gap-2 disabled:opacity-70"
                            disabled
                        >
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V5"></path>
                            </svg>
                            <span id="saveBtnText">Save for Trends</span>
                        </button>
                    </div>

                    <div id="error-container" class="hidden mt-4 p-4 bg-red-50 border border-red-200 rounded-xl">
                        <div class="flex items-center gap-2 text-red-700">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4v.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span id="error-text" class="font-medium"></span>
                        </div>
                    </div>
                </div>

                <div id="result-container" class="hidden space-y-6">
                    <div class="bg-white rounded-2xl shadow-lg p-6 border border-gray-200">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center gap-3">
                                <div class="p-2 bg-gradient-to-br from-amber-100 to-orange-100 rounded-lg">
                                    <svg class="w-6 h-6 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h2 class="text-xl font-bold text-gray-900">Analysis Results</h2>
                                    <p class="text-gray-600 text-sm">AI-Powered Insights Into Your Routine</p>
                                </div>
                            </div>
                            <div id="risk-badge" class="px-4 py-2 rounded-full text-white font-medium flex items-center gap-2"></div>
                        </div>

                        <div class="mb-8 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-100">
                            <div class="flex items-center gap-2 mb-2">
                                <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1m-16 0H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                                </svg>
                                <h3 class="font-bold text-gray-900">Overall Summary</h3>
                            </div>
                            <p id="summary" class="text-gray-700 leading-relaxed"></p>
                        </div>

                        <div class="mb-8">
                            <h3 class="font-bold text-gray-900 mb-3">Key Signals Detected</h3>
                            <div id="signals-list" class="flex flex-wrap gap-2"></div>
                        </div>

                        <div>
                            <h3 class="font-bold text-gray-900 mb-4">Personalized Recommendations</h3>
                            <div id="recommendations" class="space-y-4"></div>
                        </div>

                        <div class="mt-8 pt-6 border-t border-gray-200">
                            <div id="balance-status" class="flex items-center justify-center gap-3">
                                <div id="balance-icon" class="p-3 rounded-full"></div>
                                <div>
                                    <h4 id="balance-title" class="font-bold text-gray-900"></h4>
                                    <p id="balance-text" class="text-gray-600 text-sm"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="space-y-6">
                
                <div class="bg-white rounded-2xl shadow-lg p-6 border border-gray-200 card-hover">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-gradient-to-br from-emerald-100 to-teal-100 rounded-lg">
                                <svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                            </div>
                            <div>
                                <h2 class="text-xl font-bold text-gray-900">Saved Routines</h2>
                                <p class="text-gray-600 text-sm">Track your progress over time</p>
                            </div>
                        </div>
                        <button
                            id="downloadBtn"
                            onclick="downloadRoutines()"
                            class="p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                            title="Download routines"
                            disabled
                        >
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                            </svg>
                        </button>
                    </div>

                    <div id="saved-routines-list" class="space-y-3 max-h-96 overflow-y-auto">
                        <div class="text-center py-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V5"></path>
                                </svg>
                            </div>
                            <p class="text-gray-600 mb-2">No saved routines yet</p>
                            <p class="text-gray-500 text-sm">Save your analyzed routines to track changes over time</p>
                        </div>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl shadow-lg p-6 border border-indigo-100 card-hover">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="p-2 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-lg">
                            <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                            </svg>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-gray-900">Wellness Tips</h2>
                            <p class="text-indigo-600 text-sm">For better work-life balance</p>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="flex items-start gap-3">
                            <div class="p-2 bg-white rounded-lg shadow-sm flex-shrink-0">
                                <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900">Set Boundaries</h4>
                                <p class="text-gray-600 text-sm">Define clear work hours and stick to them</p>
                            </div>
                        </div>

                        <div class="flex items-start gap-3">
                            <div class="p-2 bg-white rounded-lg shadow-sm flex-shrink-0">
                                <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 015.646 5.646 9.001 9.001 0 0120.354 15.354z"></path>
                                </svg>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900">Sleep Schedule</h4>
                                <p class="text-gray-600 text-sm">Aim for 7-9 hours of consistent sleep</p>
                            </div>
                        </div>

                        <div class="flex items-start gap-3">
                            <div class="p-2 bg-white rounded-lg shadow-sm flex-shrink-0">
                                <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900">Daily Movement</h4>
                                <p class="text-gray-600 text-sm">30 minutes of exercise improves physical and mental health</p>
                            </div>
                        </div>

                        <div class="flex items-start gap-3">
                            <div class="p-2 bg-white rounded-lg shadow-sm flex-shrink-0">
                                <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.856-1.487M15 10h.01M11 10h.01M7 10h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                </svg>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900">Social Connection</h4>
                                <p class="text-gray-600 text-sm">Make time for friends and family regularly</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>

        <div id="result-container" class="hidden mt-10 p-6 bg-gray-50 rounded-xl shadow-md">
            <h2 class="text-2xl font-bold text-indigo-700 mb-4">Your Work-Life Balance Report</h2>

            <p id="summary" class="text-lg mb-6"></p>

            <div id="risk-box" class="px-4 py-2 rounded-lg text-white font-semibold w-fit mb-6"></div>

            <h3 class="text-xl font-semibold mb-2">Key Issues Identified</h3>
            <ul id="signals-list" class="list-disc pl-6 mb-6"></ul>

            <h3 class="text-xl font-semibold mb-2">Recommended Improvements</h3>
            <div id="recommendations"></div>
        </div>

    </div>

<script>
    const exampleRoutines = [
        "I work from 9am to 5pm, exercise at 6pm, sleep at 11pm, spend time with family in evenings",
        "Work 8am to 6pm, gym at 7pm, dinner at 8pm, work more until midnight",
        "Remote work from 10am to 7pm, walk at 8pm, relax until 12am",
        "Shift work: 3pm to 11pm, sleep at 2am, wake up at 10am",
        "Freelance: work in bursts throughout day, no fixed schedule, sleep irregularly"
    ];

    let savedRoutines = JSON.parse(localStorage.getItem("savedRoutines")) || [];
    let currentAnalysis = null;

    function loadExample(index) {
        document.getElementById("userInput").value = exampleRoutines[index];
        clearError();
    }

    function clearError() {
        document.getElementById("error-container").classList.add("hidden");
        document.getElementById("error-text").textContent = "";
    }

    function showError(message) {
        document.getElementById("error-container").classList.remove("hidden");
        document.getElementById("error-text").textContent = message;
    }

    async function sendRequest() {
        const userInput = document.getElementById("userInput").value.trim();
        
        if (!userInput) {
            showError("Please Describe Your Daily Routine");
            return;
        }

        const btn = document.getElementById("analyzeBtn");
        const btnText = document.getElementById("btnText");
        const spinner = document.getElementById("spinner");

        btn.disabled = true;
        btnText.textContent = "Analyzing...";
        spinner.classList.remove("hidden");
        clearError();

        const payload = {
            messages: [
                { role: "user", content: userInput }
            ]
        };

        try {
            const response = await fetch("https://work-life-balance-agent.onrender.com/analyze", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const result = await response.json();

            if (result.status === "success") {
                currentAnalysis = result.data.message;
                renderResult();
                document.getElementById("saveBtn").disabled = false;
            } else {
                showError(result.error_message || "Failed To Analyze Routine");
            }

        } catch (err) {
            showError("Network Error. Please Try Again.");
            console.error("Analysis error:", err);
        } finally {
            btn.disabled = false;
            btnText.textContent = "Analyze Routine";
            spinner.classList.add("hidden");
        }
    }

    function renderResult() {
        if (!currentAnalysis) return;

        const data = currentAnalysis;
        const resultContainer = document.getElementById("result-container");
        resultContainer.classList.remove("hidden");

        // Summary
        const summaryText = data.summary.charAt(0).toUpperCase() + data.summary.slice(1);
        document.getElementById("summary").textContent = summaryText;

        // Risk Badge
        const riskBadge = document.getElementById("risk-badge");
        riskBadge.textContent = "";
        riskBadge.innerHTML = getRiskBadgeHTML(data.risk_level);

        // Signals
        const signalsList = document.getElementById("signals-list");
        signalsList.innerHTML = "";
        if (data.signals && data.signals.length > 0) {
            data.signals.forEach(signal => {
                const span = document.createElement("span");
                span.className = "px-3 py-1.5 bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700 rounded-full text-sm font-medium";
                span.textContent = signal.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                signalsList.appendChild(span);
            });
        } else {
            signalsList.innerHTML = '<span class="text-gray-500 text-sm">No Specific Signals Detected</span>';
        }

        // Recommendations
        const recBox = document.getElementById("recommendations");
        recBox.innerHTML = "";
        if (data.recommendations && data.recommendations.length > 0) {
            data.recommendations.forEach((rec, idx) => {
                const priorityColor = {
                    'high': { bg: 'bg-red-50', border: 'border-l-red-500', badge: 'bg-red-100 text-red-800' },
                    'medium': { bg: 'bg-amber-50', border: 'border-l-amber-500', badge: 'bg-amber-100 text-amber-800' },
                    'low': { bg: 'bg-emerald-50', border: 'border-l-emerald-500', badge: 'bg-emerald-100 text-emerald-800' }
                }[rec.priority] || { bg: 'bg-blue-50', border: 'border-l-blue-500', badge: 'bg-blue-100 text-blue-800' };

                const div = document.createElement("div");
                div.className = `p-4 rounded-xl border-l-4 ${priorityColor.bg} ${priorityColor.border}`;
                div.innerHTML = `
                    <div class="flex items-start gap-3">
                        <div class="p-2 bg-white rounded-lg shadow-sm mt-0.5">
                            ${getCategoryIcon(rec.category)}
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-1">
                                <h4 class="font-semibold text-gray-900">${rec.category.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}</h4>
                                <span class="px-2 py-1 rounded-full text-xs font-medium ${priorityColor.badge}">
                                    ${rec.priority.charAt(0).toUpperCase() + rec.priority.slice(1)} Priority
                                </span>
                            </div>
                            <p class="text-gray-700">${rec.advice.charAt(0).toUpperCase() + rec.advice.slice(1)}</p>
                        </div>
                    </div>
                `;
                recBox.appendChild(div);
            });
        }

        // Balance Status
        const balanceIcon = document.getElementById("balance-icon");
        const balanceTitle = document.getElementById("balance-title");
        const balanceText = document.getElementById("balance-text");

        if (data.balanced) {
            balanceIcon.className = "p-3 rounded-full bg-emerald-100 text-emerald-600";
            balanceIcon.innerHTML = '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>';
            balanceTitle.textContent = "Well Balanced!";
            balanceText.textContent = "Your Routine Shows Good Work-Life Balance.";
        } else {
            balanceIcon.className = "p-3 rounded-full bg-red-100 text-red-600";
            balanceIcon.innerHTML = '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4v2m0 4v2M6.343 6.343l1.414 1.414m5.828 5.828l1.414 1.414M3 12a9 9 0 1118 0 9 9 0 01-18 0z"></path></svg>';
            balanceTitle.textContent = "Needs Improvement";
            balanceText.textContent = "Consider Implementing The Recommendations Above.";
        }
    }

    function getRiskBadgeHTML(riskLevel) {
        const risk = riskLevel?.toLowerCase();
        const config = {
            'high': { class: 'risk-high', text: 'High Risk' },
            'medium': { class: 'risk-medium', text: 'Medium Risk' },
            'low': { class: 'risk-low', text: 'Low Risk' }
        }[risk] || { class: 'bg-blue-500', text: 'Unknown Risk' };

        return `
            <div class="${config.class} inline-flex items-center gap-2">
                <span class="capitalize">${config.text}</span>
            </div>
        `;
    }

    function getCategoryIcon(category) {
        const icons = {
            'work schedule': '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',
            'sleep habits': '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 105.646 5.646 9.001 9.001 0 0020.354 15.354z"></path></svg>',
            'self-care': '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>',
            'exercise': '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>',
            'nutrition': '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2 2 0 01-2 2H2a2 2 0 01-2-2V4.774c0-.54.384-1.006.917-1.096C6.545 3.232 9.245 3 12 3"></path></svg>',
            'social': '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.856-1.487M15 10h.01M11 10h.01M7 10h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>',
            'hobbies': '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C6.5 6.253 2 10.998 2 17.25c0 5.25 3.07 9.75 10 9.75s10-4.5 10-9.75c0-6.252-4.5-11-10-11z"></path></svg>'
        };
        return icons[category?.toLowerCase()] || '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>';
    }

    function saveRoutine() {
        if (!currentAnalysis) {
            showError("Please analyze a routine first");
            return;
        }

        const newRoutine = {
            id: Date.now(),
            routine: document.getElementById("userInput").value,
            analysis: currentAnalysis,
            timestamp: new Date().toISOString(),
            date: new Date().toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            })
        };

        savedRoutines.push(newRoutine);
        localStorage.setItem("savedRoutines", JSON.stringify(savedRoutines));

        const saveBtn = document.getElementById("saveBtn");
        const originalText = saveBtn.innerHTML;
        saveBtn.innerHTML = '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg><span>Saved!</span>';
        saveBtn.disabled = true;

        setTimeout(() => {
            saveBtn.innerHTML = originalText;
            document.getElementById("userInput").value = "";
            currentAnalysis = null;
            document.getElementById("result-container").classList.add("hidden");
            document.getElementById("saveBtn").disabled = true;
            updateSavedRoutinesList();
        }, 1500);
    }

    function updateSavedRoutinesList() {
        const list = document.getElementById("saved-routines-list");
        const downloadBtn = document.getElementById("downloadBtn");
        
        if (savedRoutines.length === 0) {
            downloadBtn.disabled = true;
        } else {
            downloadBtn.disabled = false;
        }
        
        if (savedRoutines.length === 0) {
            list.innerHTML = `
                <div class="text-center py-8">
                    <div class="w-16 h-16 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V5"></path>
                        </svg>
                    </div>
                    <p class="text-gray-600 mb-2">No saved routines yet</p>
                    <p class="text-gray-500 text-sm">Save your analyzed routines to track changes over time</p>
                </div>
            `;
            return;
        }

        list.innerHTML = "";
        savedRoutines.slice().reverse().forEach((item) => {
            const riskColor = item.analysis.risk_level === 'high' 
                ? 'bg-red-50' 
                : item.analysis.risk_level === 'medium'
                ? 'bg-amber-50'
                : 'bg-emerald-50';
            
            const riskDot = item.analysis.risk_level === 'high' 
                ? 'bg-red-500' 
                : item.analysis.risk_level === 'medium'
                ? 'bg-amber-500'
                : 'bg-emerald-500';

            const div = document.createElement("div");
            div.className = `p-4 rounded-xl border border-gray-200 transition-all cursor-pointer hover:shadow-md ${riskColor}`;
            div.innerHTML = `
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium text-gray-700">${item.date}</span>
                    <div class="flex items-center gap-2">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${item.analysis.balanced ? 'bg-emerald-100 text-emerald-800' : 'bg-red-100 text-red-800'}">
                            ${item.analysis.balanced ? 'Balanced' : 'Needs Work'}
                        </span>
                        <button onclick="deleteRoutine(${item.id})" class="p-1 hover:bg-white/50 rounded transition-colors" title="Delete">
                            <svg class="w-4 h-4 text-gray-500 hover:text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <p class="text-sm text-gray-600 truncate">${item.routine}</p>
                <div class="flex items-center gap-2 mt-3">
                    <div class="w-2 h-2 rounded-full ${riskDot}"></div>
                    <span class="text-xs text-gray-500 capitalize">${item.analysis.risk_level} risk</span>
                </div>
            `;
            list.appendChild(div);
        });
    }

    function deleteRoutine(id) {
        savedRoutines = savedRoutines.filter(r => r.id !== id);
        localStorage.setItem("savedRoutines", JSON.stringify(savedRoutines));
        updateSavedRoutinesList();
    }

    function downloadRoutines() {
        const dataStr = JSON.stringify(savedRoutines, null, 2);
        const dataBlob = new Blob([dataStr], { type: "application/json" });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement("a");
        link.href = url;
        link.download = `routines-${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        URL.revokeObjectURL(url);
    }

    document.addEventListener("DOMContentLoaded", function() {
        updateSavedRoutinesList();
    });

</script>

</body>
</html>
